# Список задач

Здесь находится список функций, которые специфичны и я могу их забыть реализовать.

## ToDo

### Разное

- [ ] Добавить способ разблокировки файлов-целей, если они заблокированы другим `fileStream.Read()` или используются где-то
- [ ] Найти нормальный способ проверить нужны ли права администратора для удаления папки
  - Текущий способ проверяет это путем создания и удаления пустого файла в необходимой папке (это неправильно с точки зрения логики и производительности, но в большинстве ситуаций это работает как надо)

### Парсер шаблона

- [ ] Реализовать считывание паттернов из файла в самом патчере
- [ ] Реализовать чтение шаблона из base64-кода
  - Как в случае, если это файл с base64-кодом, там и строка-аргумент
- [ ] Добавить секции с `pre-cmd` и `pre-powershell` кодом и с `post-cmd` и `post-powershell` кодом
  - Код в секциях должен выполняться до и после выполнения патча в соответствии с названиями секций
  - Если выполнение кода секции завершилось с ошибкой - прервать работу патчера
- [ ] Добавить поддержку [глоббинга](https://stackoverflow.com/questions/30229465/what-is-file-globbing) в строки с путями к файлам/папкам, которые необходимо найти, в файле-шаблоне
- [ ] Добавить поддержку работы с относительными путями
   - Имеется ввиду пути файлов в шаблоне
- [ ] В секции для удаления файлов и папок добавить поддержку удаления только всех вложенных данных или вложенных файлов по какому-то паттерну (например `\*exe`), хотя наверное это и есть глоббинг
- [ ] Возможно стоит добавить логику запуска `.ps1` файлов от имени администратора в скрипте-парсере
   - Имеется ввиду файлы создаваемые из кода в шаблоне
- [ ] Заменить текущий способ перезапуска патчера с запросом прав администратора
  - Текущий способ ощутимо громоздкий и добавляет много сложно читаемого кода
  - Стоит заменить его на проверку возможности чтения файла, а возможность перезаписи файла, наверное, лучше реализовать в C#-ядре, потому что там происходит изменение файла

### Только ядро поиска и замены

- [ ] Переписать ядро на C#
- [ ] Реализовать перегрузки всех функций, в которые передаются паттерны
  - Чтобы паттерны можно было передавать как в виде строки, так и в виде массива байт, тк и массива байт и массива-маски для wildcard символов
- [ ] Реализовать поддержку поиска с wildcard `??` в паттернах как в [AutoIt](https://www.autoitscript.com/autoit3/docs/functions/StringRegExp.htm) или в [010 Editor](https://www.sweetscape.com/010editor/manual/Find.htm) или в [Frida Memory scan](https://frida.re/docs/javascript-api/#memory)
- [ ] Реализовать проверку наличия прав на изменение/перезапись файла сразу после первого найденного паттерна, а не после перебора всех паттернов в основном скрипте
- [ ] Реорганизовать/переписать/разделить код ядра на разные файлы в ООП-стиле
  - Например как [тут](https://github.com/Invertex/BinaryFilePatcher/blob/master/BinaryFilePatcher/BinaryFilePatcher.cs)
- [ ] Реализовать поддержку регулярных выражений в hex-шаблонах как в `sed` или `perl`
  - Возможно [этот](https://stackoverflow.com/a/55314611) пример поможет
- [ ] Реализовать поиск с помощью алгоритма Boyer-Moore-Horspool
  - [ ] Сравнить скорость работы текущего алгоритма с алгоритмом Boyer-Moore-Horspool
  - Ссылки на примеры реализованных функций поиска этим алгоритмом есть в [файле](./additional_info_RU.md#реализации-поиска-hex-паттернов-на-c) с дополнительной информацией
- [ ] Реализовать поддержку удаления hex-шаблонов
- [ ] Реализовать функцию поиска hex-паттерна начиная с определенного смещения в файле или начиная с определенной части файла в %
- [x] Реализовать поддержку ограничения замен найденных шаблонов (если нужно заменять не все найденные последовательности)

### Вывод информации

- [ ] Стилизовать прогресс-бары
  - При поиске Firewall-правил с указанными путями к exe - появляется прогресс бар отображающий прогресс выполнения процесса. Он появляется в верху терминала просто с названием метода `Get-NetFirewallRule`
- [ ] Добавить уровни логирования
  - Возможно это лучше регулировать с помощью флага в секции флагов
